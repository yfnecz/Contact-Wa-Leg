<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Your Legislators</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='site.css') }}">
  </head>
  <body>
    <div class="container">
      <p><strong>Your Name:</strong> {{ name }}</p>
      <p><strong>Address:</strong> {{ address }}</p>
      <h1 class="results-header">Your Legislators</h1>
      <p><strong>Legislative District:</strong> {{ district }}</p>
      <ul class="legislator-list compact-list">
        {% for legislator in legislators %}
          <li>
            <span class="legislator-mini">
              <strong>{{ legislator.name }}</strong> ({{ legislator.chamber }}, {{ legislator.party }})
              <a href="mailto:{{ legislator.email }}">{{ legislator.email }}</a>
              <a href="tel:{{ legislator.phone|replace(' ', '') }}">{{ legislator.phone }}</a>
              {% if legislator.la %}
                <br>
                <span class="label">Legislative Assistant:</span> {{ legislator.la }}
                {% if legislator.la_email %}
                  <a href="mailto:{{ legislator.la_email }}">{{ legislator.la_email }}</a>
                {% endif %}
              {% endif %}
              <br>
              {# Mailto button #}
              <button
                type="button"
                class="mailto-btn"
                onclick='sendMailToLawmaker(
                  {{ legislator.email|tojson }},
                  {{ legislator.la_email|default('')|tojson }},
                  {{ legislator.chamber|tojson }},
                  {{ legislator.name|tojson }}
                )'>Send below message to this lawmaker</button>
            </span>
          </li>
        {% endfor %}
      </ul>
      <h2>Email Subject</h2>
      <input type="text" id="email-subject" value="{{ subject }}" style="width:100%;margin-bottom:16px;">
      <h2>Message</h2>
      <p>Dear Senator/Representative (will be personalized)</p>
      <textarea id="email-message" rows="28" style="width:100%;font-size:1em;">{{ message }}</textarea>
    </div>
    <script>
    function sendMailToLawmaker(email, laEmail, chamber, name) {
        const subject = document.getElementById('email-subject').value;
        const message = document.getElementById('email-message').value;
        const greeting = chamber === "Senate" ? "Dear Senator" : "Dear Representative";
        const body = `${greeting} ${name},\n\n${message}`;

        let mailto = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        if (laEmail && laEmail.trim() !== "") {
            mailto += `&cc=${encodeURIComponent(laEmail)}`;
        }
        window.location.href = mailto;
    }
  </script>
  <footer style="margin-top: 40px; padding: 16px 0; border-top: 1px solid #ccc; text-align: center; font-size: 0.97em; color: #555;">
    <div>
      <span>
        <a href="https://github.com/yfnecz/contact-wa-leg" target="_blank" rel="noopener">View source / contribute on GitHub</a>
      </span>
      <br>
      <span>
        Contact: <a href="mailto:yfnecz@gmail.com">yfnecz@gmail.com</a>
      </span>
    </div>
  </footer>
  </body>
</html>